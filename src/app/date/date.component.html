<!-- MESSAGES -->
<p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"></p-confirmDialog>

<!-- CUSTOMER DATA-->
<div class="header" *ngIf=" customerService?.selectedCustomer != undefined">
  <div class="row">
    <div class="col-sm">
      <button type="button" pButton class="ui-button-warning margin-bottom" icon="pi pi-arrow-left"
        (click)="goToCustomerView()" label="Ver Ficha Cliente"></button>
    </div>
    <div class="col-sm">
      <h4 color="blue">Registrar cita para: {{ customerService?.selectedCustomer.name }}  {{ customerService?.selectedCustomer.lastname }}</h4>
    </div>
    <div class="col-sm"></div>
  </div>
</div>

<ng-template #loading>
  <div class="text-center">
    <i class="fa fa-spin fa-spinner fa-5x"></i> <br />
    Loading events...
  </div>
</ng-template>

<div *ngIf="events$ | async; else loading; let events">
  <div class="row text-center">
    <div class="col-md-4">
      <div class="btn-group">
        <div class="btn btn-primary" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate"
          (viewDateChange)="closeOpenMonthViewDay()">
          Anterior
        </div>
        <div class="btn btn-outline-secondary" mwlCalendarToday [(viewDate)]="viewDate" (viewDateChange)="loadEvents()">
          Hoy
        </div>
        <div class="btn btn-primary" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate"
          (viewDateChange)="closeOpenMonthViewDay()">
          Siguiente
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):locale:weekStartsOn:excludeDays }}</h3>
    </div>
    <div class="col-md-4">
      <div class="btn-group">
        <div class="btn btn-primary" (click)="setView(CalendarView.Month)" [class.active]="view === CalendarView.Month">
          Mes
        </div>
        <div class="btn btn-primary" (click)="setView(CalendarView.Week)" [class.active]="view === CalendarView.Week">
          Semana
        </div>
        <!--<div
        class="btn btn-primary"
        (click)="setView(CalendarView.Day)"
        [class.active]="view === CalendarView.Day"
      >
        Dia
      </div>
    -->
      </div>
    </div>
  </div>
  <br />
  <div [ngSwitch]="view">
    <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" 
    [viewDate]="viewDate"
    [events]="events"
    [refresh]="refresh"
    [locale]="locale"
    [activeDayIsOpen]="activeDayIsOpen"
    [excludeDays]="excludeDays" 
    (eventClicked)="handleEvent('Clicked', $event.event)"
    (dayClicked)="dayClicked($event.day)"
    (eventTimesChanged)="eventTimesChanged($event)">
    </mwl-calendar-month-view>
    
    <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" 
    [viewDate]="viewDate" 
    [events]="events"
    [refresh]="refresh" 
    [locale]="locale" 
    [dayStartHour]="9" 
    [dayEndHour]="20" 
    [excludeDays]="excludeDays"
    [weekStartsOn]="weekStartsOn" 
    [weekendDays]="weekendDays" 
    (eventClicked)="handleEvent('Clicked', $event.event)"
    (eventTimesChanged)="eventTimesChanged($event)" 
    (dayHeaderClicked)="clickedDate = $event.day.date"
    (hourSegmentClicked)="clickHour($event.date)">
    </mwl-calendar-week-view>
    
    <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day" 
    [viewDate]="viewDate" 
    [events]="events" 
    [refresh]="refresh"
    [locale]="locale"
    [dayStartHour]="5" 
    [dayEndHour]="20" 
    (eventClicked)="handleEvent('Clicked', $event.event)"
    (eventTimesChanged)="eventTimesChanged($event)" 
    (hourSegmentClicked)="clickHour($event.date)">
    </mwl-calendar-day-view>
  </div>
</div>

<br /><br /><br />

<ng-template #modalContent let-close="close">
  <div class="modal-header">
    <h5 class="modal-title">{{modalData?.event?.title}}</h5>
    <button type="button" class="close" (click)="close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <h3>Hora: {{modalData?.event?.start | date:'HH:mm'}} - {{modalData?.event?.end | date:'HH:mm'}}</h3>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="close()">
      Cerrar
    </button>

    <button type="button" class="btn btn-outline-danger" (click)="deleteEvent(modalData.event)">
        Borrar Cita
      </button>
  </div>
</ng-template>


<ng-template #modalCustomerDate let-close="close">
    <div class="modal-header">
      <h5 class="modal-title">Asignar una cita a un cliente</h5>
      <button type="button" class="close" (click)="close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <h5>Hora: {{modalCustomerDateData?.start | date:'HH:mm'}} - {{ modalCustomerDateData?.end | date:'HH:mm'}}</h5>
        <br>
        <p-dropdown [style]="{'width':'100%'}" [options]="modalCustomerDateData.customers" [(ngModel)]="selectedCustomer" [filter]="true"></p-dropdown>    
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="close()">
        Cancelar
      </button>
      <button type="button" class="btn btn-outline-success" (click)="addEvent()">
      Aceptar
      </button>
    </div>
  </ng-template>